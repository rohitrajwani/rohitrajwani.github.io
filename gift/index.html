<html>

<head>  
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    
    <link rel="stylesheet" href="loader.css">
    <link rel="stylesheet" href="style.css">
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
</head>

<body>
    <div class="container row z-depth-3">
        <div class="col l12 s12">
            <h4 class="col s12">Please enter Bill Amount below</h4>
            <div class="col l6 offset-l3 m12 s12">
                <input style="font-size: 30px" class="col s12" id="billAmount">
                <button style="margin-top: 15px" class="col l6 offset-l3 m8 offset-m2 s12" onclick="findGift()">Find Gift</button>
                <p id="error" class="col s12" style="display: none; color: firebrick">Please enter bill amount.</p>
            </div>
            
            <div class="gift-container col s12">
                <div id="loader" class='loader-container col l6 offset-l3' style="display: none">
                  <div class='loader'>
                    <div class='loader--dot'></div>
                    <div class='loader--dot'></div>
                    <div class='loader--dot'></div>
                    <div class='loader--dot'></div>
                    <div class='loader--dot'></div>
                    <div class='loader--dot'></div>
                    <div class='loader--text'></div>
                  </div>
                </div>

                <div id="gift" class="col s12" style="display: none;">
                    <div style="padding: 5px;margin-top: 25px; text-align: center;" class="card col l4 offset-l4 s12">
                        <div class="card-image">
                          <img id="gift-image" src="https://rukminim1.flixcart.com/image/832/832/ky0g58w0/handkerchief/c/i/t/white-handkerchief-pack-of-3-3-hk01-hk01-jockey-original-imagacfwkfgfgbwn.jpeg?q=70">
                        </div>
                        <div class="card-action">
                          <h6 id="gift-text">Jockey Handkerchief</h6>
                        </div>
                    </div>
                    <h5 class="col s12">Thank You for Shopping with us..!!</h5>
                </div>
            </div>
            
            
        </div>
    </div>
    
    <script type="text/javascript" src="rules.json"></script>

    <script>
        function random(min, max) { // min and max included 
            return Math.floor(Math.random() * (max - min + 1) + min)
        }

        var offers;
        $.getJSON("rules.json", (data) => offers = data);
        
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function findGift() {
            
            $("#gift").hide();
            
            var billAmount = $("#billAmount").val();
            
            if (billAmount == undefined || billAmount == "" || billAmount == 0) {
                $("#error").fadeIn(100);
                
                setTimeout(() => {
                    $("#error").fadeOut(100);
                }, 4000);
                
                return;
            }

            for (offer of offers) {
                if (billAmount >= offer.start && billAmount < offer.end) {
                    gift = offer.gifts[random(0, offer.gifts.length - 1)];
                    $("#gift-image").attr("src",gift.image_src);
                    $("#gift-text").text(gift.gift_name);
                    break;
                }
            }
            
            $("#loader").fadeIn(500);
            
            setTimeout(() => {
                $("#loader").fadeOut(500);
                setTimeout(() => $("#gift").fadeIn(1000), 500);
            },4000);
            
            
        }
    </script>
</body>

</html>